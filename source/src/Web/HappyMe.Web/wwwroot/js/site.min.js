/*!
 *
 * Copyright 2009-2013 Kris Kowal under the terms of the MIT
 * license found at http://github.com/kriskowal/q/raw/master/LICENSE
 *
 * With parts by Tyler Close
 * Copyright 2007-2009 Tyler Close under the terms of the MIT X license found
 * at http://www.opensource.org/licenses/mit-license.html
 * Forked at ref_send.js version: 2009-05-11
 *
 * With parts by Mark Miller
 * Copyright (C) 2011 Google Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 */
function isObject(n){return n===Object(n)}function makeStackTraceLong(n,t){var r,i,u;if(hasStacks&&t.stack&&typeof n=="object"&&n!==null&&n.stack&&n.stack.indexOf(STACK_JUMP_SEPARATOR)===-1){for(r=[],i=t;!!i&&handlers.get(i);i=handlers.get(i).became)i.stack&&r.unshift(i.stack);r.unshift(n.stack);u=r.join("\n"+STACK_JUMP_SEPARATOR+"\n");n.stack=filterStackString(u)}}function filterStackString(n){var r,u,i,t;if(Q.isIntrospective)return n;for(r=n.split("\n"),u=[],i=0;i<r.length;++i)t=r[i],isInternalFrame(t)||isNodeFrame(t)||!t||u.push(t);return u.join("\n")}function isNodeFrame(n){return n.indexOf("(module.js:")!==-1||n.indexOf("(node.js:")!==-1}function getFileNameAndLineNumber(n){var r=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(n),t,i;return r?[r[1],Number(r[2])]:(t=/at ([^ ]+):(\d+):(?:\d+)$/.exec(n),t)?[t[1],Number(t[2])]:(i=/.*@(.+):(\d+)$/.exec(n),i?[i[1],Number(i[2])]:void 0)}function isInternalFrame(n){var t=getFileNameAndLineNumber(n),r,i;return t?(r=t[0],i=t[1],r===qFileName&&i>=qStartingLine&&i<=qEndingLine):!1}function captureLine(){if(hasStacks)try{throw new Error;}catch(i){var n=i.stack.split("\n"),r=n[0].indexOf("@")>0?n[1]:n[2],t=getFileNameAndLineNumber(r);return t?(qFileName=t[0],t[1]):void 0}}function deprecate(n,t,i){return function(){return typeof console!="undefined"&&typeof console.warn=="function"&&(i?console.warn(t+" is deprecated, use "+i+" instead.",new Error("").stack):console.warn(t+" is deprecated.",new Error("").stack)),n.apply(this,arguments)}}function Q_getHandler(n){var t=handlers.get(n);return!t||!t.became?t:(t=follow(t),handlers.set(n,t),t)}function follow(n){return n.became?(n.became=follow(n.became),n.became):n}function Q(n){return Q_isPromise(n)?n:isThenable(n)?(thenables.has(n)||thenables.set(n,new Promise(new Thenable(n))),thenables.get(n)):new Promise(new Fulfilled(n))}function Q_reject(n){return new Promise(new Rejected(n))}function defer(){var i=new Pending,n=new Promise(i),r=new Deferred(n);if(Q.longStackSupport&&hasStacks)try{throw new Error;}catch(t){n.stack=t.stack.substring(t.stack.indexOf("\n")+1)}return r}function Q_all(n){function o(){t=-Infinity;for(var n=0;n<i.length;n++)i[n]>t&&(t=i[n])}if(Q_isPromise(n))return typeof console!="undefined"&&typeof console.warn=="function"&&console.warn("Q.all no longer directly unwraps a promise. Use Q(array).all()"),Q(n).all();var f=0,r=defer(),u=Array(n.length),i=[],t=-Infinity,e;return Array.prototype.forEach.call(n,function(s,h){var c;Q_isPromise(s)&&(c=Q_getHandler(s)).state==="fulfilled"?u[h]=c.value:(++f,s=Q(s),s.then(function(n){u[h]=n;--f==0&&r.resolve(u)},r.reject),s.observeEstimate(function(u){var f=i[h];i[h]=u;u>t?t=u:f===t&&u<=t&&o();i.length===n.length&&t!==e&&(r.setEstimate(t),e=t)}))}),f===0&&r.resolve(u),r.promise}function Q_allSettled(n){return Q_isPromise(n)?(typeof console!="undefined"&&typeof console.warn=="function"&&console.warn("Q.allSettled no longer directly unwraps a promise. Use Q(array).allSettled()"),Q(n).allSettled()):Q_all(n.map(function(n){function t(){return n.inspect()}return n=Q(n),n.then(t,t)}))}function Q_spread(n,t,i){return Q(n).spread(t,i)}function Q_race(n){return new Promise(function(t){n.forEach(function(n){Q(n).then(t.resolve,t.reject)})})}function Promise_function(n){return function(){for(var i=new Array(arguments.length),t=0;t<arguments.length;t++)i[t]=arguments[t];return Q(n).apply(this,i)}}function Q_async(n){return function(){function t(n,t){var f;try{f=r[n](t)}catch(e){return Q_reject(e)}return f.done?Q(f.value):Q(f.value).then(i,u)}var r=n.apply(this,arguments),i=t.bind(t,"next"),u=t.bind(t,"throw");return i()}}function Q_spawn(n){Q_async(n)().done()}function Promise(n){if(!(this instanceof Promise))return new Promise(n);if(typeof n=="function"){var i=n,t=defer();n=Q_getHandler(t.promise);try{i(t.resolve,t.reject,t.setEstimate)}catch(r){t.reject(r)}}handlers.set(this,n)}function Promise_resolve(n){return Q(n)}function Q_isPromise(n){return isObject(n)&&!!handlers.get(n)}function isThenable(n){return isObject(n)&&typeof n.then=="function"}function Promise_rethrow(n){throw n;}function Deferred(n){var t,i,r;this.promise=n;promises.set(this,n);t=this;i=this.resolve;this.resolve=function(n){i.call(t,n)};r=this.reject;this.reject=function(n){r.call(t,n)}}function Fulfilled(n){this.value=n;this.estimate=Date.now()}function Rejected(n){this.reason=n;this.estimate=Infinity}function Pending(){this.messages=[];this.observers=[];this.estimate=Infinity}function Thenable(n){this.thenable=n;this.became=null;this.estimate=Infinity}function Passed(n){this.promise=n}var hasStacks,qStartingLine,qFileName,STACK_JUMP_SEPARATOR,handlers,passByCopies,promises,qEndingLine,HappyMe;hasStacks=!1;try{throw new Error;}catch(e){hasStacks=!!e.stack}qStartingLine=captureLine();require("collections/shim");var WeakMap=require("collections/weak-map"),Iterator=require("collections/iterator"),asap=require("asap");STACK_JUMP_SEPARATOR="From previous event:";handlers=new WeakMap;var theViciousCycleError=new Error("Can't resolve a promise with itself"),theViciousCycleRejection=Q_reject(theViciousCycleError),theViciousCycle=Q_getHandler(theViciousCycleRejection),thenables=new WeakMap;module.exports=Q;Q.longStackSupport=!1;Q.reject=Q_reject;Q.defer=defer;Q.when=function(n,t,i,r){return Q(n).then(t,i,r)};Q.all=Q_all;Q.allSettled=Q_allSettled;Q.delay=function(n,t){return t===void 0&&(t=n,n=void 0),Q(n).delay(t)};Q.timeout=function(n,t,i){return Q(n).timeout(t,i)};Q.spread=Q_spread;Q.join=function(n,t){return Q.spread([n,t],function(n,t){if(n===t)return n;throw new Error("Can't join: not the same: "+n+" "+t);})};Q.race=Q_race;Q.try=function(n){return Q(n).dispatch("call",[[]])};Q.function=Promise_function;Q.promised=function(n){return function(){for(var i=new Array(arguments.length),t=0;t<arguments.length;t++)i[t]=arguments[t];return Q_spread([this,Q_all(i)],function(t,i){return n.apply(t,i)})}};Q.passByCopy=Q.push=function(n){return Object(n)!==n||Q_isPromise(n)||passByCopies.set(n,!0),n};Q.isPortable=function(n){return Object(n)===n&&passByCopies.has(n)};passByCopies=new WeakMap;Q.async=Q_async;Q.spawn=Q_spawn;Q.Promise=Promise;Promise.all=Q_all;Promise.race=Q_race;Promise.resolve=Promise_resolve;Promise.reject=Q_reject;Q.isPromise=Q_isPromise;Promise.prototype.inspect=function(){return Q_getHandler(this).inspect()};Promise.prototype.isPending=function(){return Q_getHandler(this).state==="pending"};Promise.prototype.isFulfilled=function(){return Q_getHandler(this).state==="fulfilled"};Promise.prototype.isRejected=function(){return Q_getHandler(this).state==="rejected"};Promise.prototype.toBePassed=function(){return Q_getHandler(this).state==="passed"};Promise.prototype.toString=function(){return"[object Promise]"};Promise.prototype.then=function(n,t,i){var o=this,r=defer(),f,e,u;return f=typeof n=="function"?function(t){try{r.resolve(n.call(void 0,t))}catch(i){r.reject(i)}}:r.resolve,e=typeof t=="function"?function(n){try{r.resolve(t.call(void 0,n))}catch(i){r.reject(i)}}:r.reject,this.done(f,e),i!==void 0&&(u=function(){r.setEstimate(o.getEstimate()+i)},this.observeEstimate(u),u()),r.promise};Promise.prototype.done=function(n,t){var r=this,i=!1;asap(function(){var f,u;typeof n=="function"&&(f=Q.onerror?function(t){if(!i){i=!0;try{n.call(void 0,t)}catch(r){(Q.onerror||Promise_rethrow)(r)}}}:function(t){i||(i=!0,n.call(void 0,t))});u=typeof t=="function"&&Q.onerror?function(n){if(!i){i=!0;makeStackTraceLong(n,r);try{t.call(void 0,n)}catch(u){(Q.onerror||Promise_rethrow)(u)}}}:typeof t=="function"?function(n){i||(i=!0,makeStackTraceLong(n,r),t.call(void 0,n))}:Q.onerror||Promise_rethrow;typeof process=="object"&&process.domain&&(u=process.domain.bind(u));Q_getHandler(r).dispatch(f,"then",[u])})};Promise.prototype.thenResolve=function(n){return n=Q(n),Q_all([this,n]).then(function(){return n},null,0)};Promise.prototype.thenReject=function(n){return this.then(function(){throw n;},null,0)};Promise.prototype.all=function(){return this.then(Q_all)};Promise.prototype.allSettled=function(){return this.then(Q_allSettled)};Promise.prototype.catch=function(n){return this.then(void 0,n)};Promise.prototype.finally=function(n,t){return n?(n=Q(n),this.then(function(t){return n.call().then(function(){return t})},function(t){return n.call().then(function(){throw t;})},t)):this};Promise.prototype.observeEstimate=function(n){return this.rawDispatch(null,"estimate",[n]),this};Promise.prototype.getEstimate=function(){return Q_getHandler(this).estimate};Promise.prototype.dispatch=function(n,t){var i=defer();return this.rawDispatch(i.resolve,n,t),i.promise};Promise.prototype.rawDispatch=function(n,t,i){var r=this;asap(function(){Q_getHandler(r).dispatch(n,t,i)})};Promise.prototype.get=function(n){return this.dispatch("get",[n])};Promise.prototype.invoke=function(n){for(var i=new Array(arguments.length-1),t=1;t<arguments.length;t++)i[t-1]=arguments[t];return this.dispatch("invoke",[n,i])};Promise.prototype.apply=function(n,t){return this.dispatch("call",[t,n])};Promise.prototype.call=function(n){for(var i=new Array(Math.max(0,arguments.length-1)),t=1;t<arguments.length;t++)i[t-1]=arguments[t];return this.dispatch("call",[i,n])};Promise.prototype.bind=function(n){for(var r=this,i=new Array(Math.max(0,arguments.length-1)),t=1;t<arguments.length;t++)i[t-1]=arguments[t];return function(){for(var t=i.slice(),u=0;u<arguments.length;u++)t[t.length]=arguments[u];return r.dispatch("call",[t,n])}};Promise.prototype.keys=function(){return this.dispatch("keys",[])};Promise.prototype.iterate=function(){return this.dispatch("iterate",[])};Promise.prototype.spread=function(n,t,i){return this.all().then(function(t){return n.apply(void 0,t)},t,i)};Promise.prototype.timeout=function(n,t){var i=defer(),r=setTimeout(function(){i.reject(new Error(t||"Timed out after "+n+" ms"))},n);return this.then(function(n){clearTimeout(r);i.resolve(n)},function(n){clearTimeout(r);i.reject(n)}),i.promise};Promise.prototype.delay=function(n){return this.then(function(t){var i=defer();return i.setEstimate(Date.now()+n),setTimeout(function(){i.resolve(t)},n),i.promise},null,n)};Promise.prototype.pull=function(){return this.dispatch("pull",[])};Promise.prototype.pass=function(){return this.toBePassed()?this:new Promise(new Passed(this))};promises=new WeakMap;Deferred.prototype.resolve=function(n){var t=Q_getHandler(promises.get(this));t.messages&&t.become(Q(n))};Deferred.prototype.reject=function(n){var t=Q_getHandler(promises.get(this));t.messages&&t.become(Q_reject(n))};Deferred.prototype.setEstimate=function(n){if(n=+n,n!==n&&(n=Infinity),n<1e12&&n!==-Infinity)throw new Error("Estimate values should be a number of miliseconds in the future");var t=Q_getHandler(promises.get(this));t.setEstimate&&t.setEstimate(n)};Fulfilled.prototype.state="fulfilled";Fulfilled.prototype.inspect=function(){return{state:"fulfilled",value:this.value}};Fulfilled.prototype.dispatch=function(n,t,i){var r,u;if(t==="then"||t==="get"||t==="call"||t==="invoke"||t==="keys"||t==="iterate"||t==="pull")try{r=this[t].apply(this,i)}catch(f){r=Q_reject(f)}else t==="estimate"?i[0].call(void 0,this.estimate):(u=new Error("Fulfilled promises do not support the "+t+" operator"),r=Q_reject(u));n&&n(r)};Fulfilled.prototype.then=function(){return this.value};Fulfilled.prototype.get=function(n){return this.value[n]};Fulfilled.prototype.call=function(n,t){return this.callInvoke(this.value,n,t)};Fulfilled.prototype.invoke=function(n,t){return this.callInvoke(this.value[n],t,this.value)};Fulfilled.prototype.callInvoke=function(n,t,i){for(var f,r,u=0;u<t.length;u++)Q_isPromise(t[u])&&t[u].toBePassed()&&(r=r||[],r.push(t[u]));return r?(f=this,Q_all(r).then(function(){return f.callInvoke(n,t.map(function(n){return Q_isPromise(n)&&n.toBePassed()?n.inspect().value:n}),i)})):n.apply(i,t)};Fulfilled.prototype.keys=function(){return Object.keys(this.value)};Fulfilled.prototype.iterate=function(){return new Iterator(this.value)};Fulfilled.prototype.pull=function(){var n,t;if(Object(this.value)===this.value){n=Array.isArray(this.value)?[]:{};for(t in this.value)n[t]=this.value[t]}else n=this.value;return Q.push(n)};Rejected.prototype.state="rejected";Rejected.prototype.inspect=function(){return{state:"rejected",reason:this.reason}};Rejected.prototype.dispatch=function(n,t,i){var r;r=t==="then"?this.then(n,i[0]):this;n&&n(r)};Rejected.prototype.then=function(n,t){return t?t(this.reason):this};Pending.prototype.state="pending";Pending.prototype.inspect=function(){return{state:"pending"}};Pending.prototype.dispatch=function(n,t,i){if(this.messages.push([n,t,i]),t==="estimate"){this.observers.push(i[0]);var r=this;asap(function(){i[0].call(void 0,r.estimate)})}};Pending.prototype.become=function(n){this.became=theViciousCycle;var t=Q_getHandler(n);this.became=t;handlers.set(n,t);this.promise=void 0;this.messages.forEach(function(t){asap(function(){var i=Q_getHandler(n);i.dispatch.apply(i,t)})});this.messages=void 0;this.observers=void 0};Pending.prototype.setEstimate=function(n){if(this.observers){var t=this;t.estimate=n;this.observers.forEach(function(t){asap(function(){t.call(void 0,n)})})}};Thenable.prototype.state="thenable";Thenable.prototype.inspect=function(){return{state:"pending"}};Thenable.prototype.cast=function(){if(!this.became){var n=defer(),t=this.thenable;asap(function(){try{t.then(n.resolve,n.reject)}catch(i){n.reject(i)}});this.became=Q_getHandler(n.promise)}return this.became};Thenable.prototype.dispatch=function(n,t,i){this.cast().dispatch(n,t,i)};Passed.prototype.state="passed";Passed.prototype.inspect=function(){return this.promise.inspect()};Passed.prototype.dispatch=function(n,t,i){return this.promise.rawDispatch(n,t,i)};Q.ninvoke=function(n,t){for(var r,u=new Array(Math.max(0,arguments.length-1)),i=2;i<arguments.length;i++)u[i-2]=arguments[i];return r=Q.defer(),u[i-2]=r.makeNodeResolver(),Q(n).dispatch("invoke",[t,u]).catch(r.reject),r.promise};Promise.prototype.ninvoke=function(n){for(var i,r=new Array(arguments.length),t=1;t<arguments.length;t++)r[t-1]=arguments[t];return i=Q.defer(),r[t-1]=i.makeNodeResolver(),this.dispatch("invoke",[n,r]).catch(i.reject),i.promise};Q.denodeify=function(n,t){return function(){for(var u=new Array(arguments.length+1),i=0,r;i<arguments.length;i++)u[i]=arguments[i];return r=Q.defer(),u[i]=r.makeNodeResolver(t),Q(n).apply(this,u).catch(r.reject),r.promise}};Deferred.prototype.makeNodeResolver=function(n){var t=this.resolve;return n===!0?function(n){var r,i;if(n)t(Q_reject(n));else{for(r=new Array(Math.max(0,arguments.length-1)),i=1;i<arguments.length;i++)r[i-1]=arguments[i];t(r)}}:n?function(i){var r,u;if(i)t(Q_reject(i));else{r={};for(u in n)r[n[u]]=arguments[u+1];t(r)}}:function(n,i){n?t(Q_reject(n)):t(i)}};Promise.prototype.nodeify=function(n){if(n)this.done(function(t){n(null,t)},n);else return this};Q.nextTick=deprecate(asap,"nextTick","asap package");Q.resolve=deprecate(Q,"resolve","Q");Q.fulfill=deprecate(Q,"fulfill","Q");Q.isPromiseAlike=deprecate(isThenable,"isPromiseAlike","(not supported)");Q.fail=deprecate(function(n,t){return Q(n).catch(t)},"Q.fail","Q(value).catch");Q.fin=deprecate(function(n,t){return Q(n).finally(t)},"Q.fin","Q(value).finally");Q.progress=deprecate(function(n){return n},"Q.progress","no longer supported");Q.thenResolve=deprecate(function(n,t){return Q(n).thenResolve(t)},"thenResolve","Q(value).thenResolve");Q.thenReject=deprecate(function(n,t){return Q(n).thenResolve(t)},"thenResolve","Q(value).thenResolve");Q.isPending=deprecate(function(n){return Q(n).isPending()},"isPending","Q(value).isPending");Q.isFulfilled=deprecate(function(n){return Q(n).isFulfilled()},"isFulfilled","Q(value).isFulfilled");Q.isRejected=deprecate(function(n){return Q(n).isRejected()},"isRejected","Q(value).isRejected");Q.master=deprecate(function(n){return n},"master","no longer necessary");Q.makePromise=function(){throw new Error("makePromise is no longer supported");};Q.dispatch=deprecate(function(n,t,i){return Q(n).dispatch(t,i)},"dispatch","Q(value).dispatch");Q.get=deprecate(function(n,t){return Q(n).get(t)},"get","Q(value).get");Q.keys=deprecate(function(n){return Q(n).keys()},"keys","Q(value).keys");Q.post=deprecate(function(n,t,i){return Q(n).post(t,i)},"post","Q(value).invoke (spread arguments)");Q.mapply=deprecate(function(n,t,i){return Q(n).post(t,i)},"post","Q(value).invoke (spread arguments)");Q.send=deprecate(function(n,t){return Q(n).post(t,Array.prototype.slice.call(arguments,2))},"send","Q(value).invoke");Q.set=function(){throw new Error("Q.set no longer supported");};Q.delete=function(){throw new Error("Q.delete no longer supported");};Q.nearer=deprecate(function(n){return Q_isPromise(n)&&n.isFulfilled()?n.inspect().value:n},"nearer","inspect().value (+nuances)");Q.fapply=deprecate(function(n,t){return Q(n).dispatch("call",[t])},"fapply","Q(callback).apply(thisp, args)");Q.fcall=deprecate(function(n){return Q(n).dispatch("call",[Array.prototype.slice.call(arguments,1)])},"fcall","Q(callback).call(thisp, ...args)");Q.fbind=deprecate(function(n){var t=Q(n),i=Array.prototype.slice.call(arguments,1);return function(){return t.dispatch("call",[i.concat(Array.prototype.slice.call(arguments)),this])}},"fbind","bind with thisp");Q.promise=deprecate(Promise,"promise","Promise");Promise.prototype.fapply=deprecate(function(n){return this.dispatch("call",[n])},"fapply","apply with thisp");Promise.prototype.fcall=deprecate(function(){return this.dispatch("call",[Array.prototype.slice.call(arguments)])},"fcall","try or call with thisp");Promise.prototype.fail=deprecate(function(n){return this.catch(n)},"fail","catch");Promise.prototype.fin=deprecate(function(n){return this.finally(n)},"fin","finally");Promise.prototype.set=function(){throw new Error("Promise set no longer supported");};Promise.prototype.delete=function(){throw new Error("Promise delete no longer supported");};Deferred.prototype.notify=deprecate(function(){},"notify","no longer supported");Promise.prototype.progress=deprecate(function(){return this},"progress","no longer supported");Promise.prototype.mapply=deprecate(function(n,t){return this.dispatch("invoke",[n,t])},"mapply","invoke");Promise.prototype.fbind=deprecate(function(){return Q.fbind.apply(Q,[void 0].concat(Array.prototype.slice.call(arguments)))},"fbind","bind(thisp, ...args)");Promise.prototype.send=deprecate(function(){return this.dispatch("invoke",[name,Array.prototype.slice.call(arguments,1)])},"send","invoke");Promise.prototype.mcall=deprecate(function(){return this.dispatch("invoke",[name,Array.prototype.slice.call(arguments,1)])},"mcall","invoke");Promise.prototype.passByCopy=deprecate(function(n){return n},"passByCopy","Q.passByCopy");Q.nfapply=deprecate(function(n,t){var i=Q.defer(),r=Array.prototype.slice.call(t);return r.push(i.makeNodeResolver()),Q(n).apply(this,r).catch(i.reject),i.promise},"nfapply");Promise.prototype.nfapply=deprecate(function(n){return Q.nfapply(this,n)},"nfapply");Q.nfcall=deprecate(function(n){var t=Array.prototype.slice.call(arguments,1);return Q.nfapply(n,t)},"nfcall");Promise.prototype.nfcall=deprecate(function(){for(var t=new Array(arguments.length),n=0;n<arguments.length;n++)t[n]=arguments[n];return Q.nfapply(this,t)},"nfcall");Q.nfbind=deprecate(function(n){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.concat(Array.prototype.slice.call(arguments)),i=Q.defer();return r.push(i.makeNodeResolver()),Q(n).apply(this,r).catch(i.reject),i.promise}},"nfbind","denodeify (with caveats)");Promise.prototype.nfbind=deprecate(function(){for(var t=new Array(arguments.length),n=0;n<arguments.length;n++)t[n]=arguments[n];return Q.nfbind(this,t)},"nfbind","denodeify (with caveats)");Q.nbind=deprecate(function(n,t){var i=Array.prototype.slice.call(arguments,2);return function(){function f(){return n.apply(t,arguments)}var u=i.concat(Array.prototype.slice.call(arguments)),r=Q.defer();return u.push(r.makeNodeResolver()),Q(f).apply(this,u).catch(r.reject),r.promise}},"nbind","denodeify (with caveats)");Q.npost=deprecate(function(n,t,i){var r=Q.defer();return i.push(r.makeNodeResolver()),Q(n).dispatch("invoke",[t,i]).catch(r.reject),r.promise},"npost","ninvoke (with spread arguments)");Promise.prototype.npost=deprecate(function(n,t){return Q.npost(this,n,t)},"npost","Q.ninvoke (with caveats)");Q.nmapply=deprecate(Q.nmapply,"nmapply","q/node nmapply");Promise.prototype.nmapply=deprecate(Promise.prototype.npost,"nmapply","Q.nmapply");Q.nsend=deprecate(Q.ninvoke,"nsend","q/node ninvoke");Q.nmcall=deprecate(Q.ninvoke,"nmcall","q/node ninvoke");Promise.prototype.nsend=deprecate(Promise.prototype.ninvoke,"nsend","q/node ninvoke");Promise.prototype.nmcall=deprecate(Promise.prototype.ninvoke,"nmcall","q/node ninvoke");qEndingLine=captureLine();HappyMe=HappyMe||{};HappyMe.HttpRequester=function(){"use strict";var n=function(n,t,i){var r=Q.defer();return i&&(i=JSON.stringify(i)),$.ajax({url:n,type:t,data:i,contentType:"application/json",success:function(n){r.resolve(n)},error:function(n){r.reject(n)}}),r.promise},t=function(t){return n(t,"get")},i=function(t,i){return n(t,"post",i)};return{getJson:t,postJson:i}}();HappyMe=HappyMe||{};HappyMe.ColorUtils=function(){"use strict";var n=function(n,t,i){var r,u,f;if(n=Math.max(0,Math.min(360,n)),t=Math.max(0,Math.min(100,t)),i=Math.max(0,Math.min(100,i)),t/=100,i/=100,t===0)return r=u=f=i,[Math.round(r*255),Math.round(u*255),Math.round(f*255)];n/=60;var e=Math.floor(n),c=n-e,o=i*(1-t),s=i*(1-t*c),h=i*(1-t*(1-c));return e===0?(r=i,u=h,f=o):e===1?(r=s,u=i,f=o):e===2?(r=o,u=i,f=h):e===3?(r=o,u=s,f=i):e===4?(r=h,u=o,f=i):(r=i,u=o,f=s),[Math.round(r*255),Math.round(u*255),Math.round(f*255)]},t=function(t){for(var u=360/(t-1),r=[],i=0;i<t;i++)r.push(n(u*i,100,100));return r},i=function(n){for(var f,u=[],r=t(n),i=0;i<r.length;i++)f="rgb("+r[i][0]+", "+r[i][1]+", "+r[i][2]+")",u.push(f);return u};return{getDistinctColors:i}}();